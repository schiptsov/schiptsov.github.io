<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2022-11-30 Wed 10:44 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Scala3</title>
<meta name="author" content="&lt;schiptsov@gmail.com&gt;" />
<meta name="generator" content="Org Mode" />
<link rel="preconnect" href="https://fonts.googleapis.com">

<link href="https://fonts.googleapis.com/css?family=Fira Sans" rel="stylesheet">

<link href="https://fonts.googleapis.com/css?family=Fira Code" rel="stylesheet">

<link rel='stylesheet' type='text/css' href='/css/main.css'/>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content" class="content">
<header>
<h1 class="title">Scala3</h1>
</header><p>
When the language specification and the compiler are done, we face a
slow, painful but doable <code>2 -&gt; 3</code> transition, similar to what Python went
through.
</p>

<p>
It is not just matter of accessing old classes, it is an effort to
rewrite parts of important codebases (Spark, Kafka, the Twitter stack)
to use the new standard library and its better abstractions (due to
better typing).
</p>

<div id="outline-container-orgbea49f5" class="outline-3">
<h3 id="orgbea49f5">Product types</h3>
<div class="outline-text-3" id="text-orgbea49f5">
<p>
<i>Case-classes</i> are used to define <i>immutable values which have its own structure</i> and
&ldquo;normal&rdquo; classes can create <i>mutable record types</i>. <i>Companion objects</i> provide an
additional  <i>name-space</i>. /Extensions are also useful.
</p>
</div>
</div>
<div id="outline-container-org52f11d8" class="outline-3">
<h3 id="org52f11d8">Sum types</h3>
<div class="outline-text-3" id="text-org52f11d8">
<p>
<i>Enums</i> are Scala&rsquo;s  attempt on generalized <i>sum-types</i>, or even GADTs, and they
seem OK due to the ability to define fields and methods, just like in a
<i>companion object</i>. They can be <i>parameterized</i>, just like Traits.
</p>
</div>
</div>
<div id="outline-container-org64041e3" class="outline-3">
<h3 id="org64041e3">Type-classes</h3>
<div class="outline-text-3" id="text-org64041e3">
<p>
Parameterized <i>Traits</i> are now the solid basis of proper <i>type-classes</i>, which are as
fundamental as Liskov&rsquo;s ADTs, and one should <i>abstract out with traits</i>.
</p>

<p>
Just like ADTs, type-classes (based on composable <i>Traits</i>) define <i>abstract
interfaces</i> (to be implemented), thus introducing an <i>abstraction barrier</i> by
abstracting away everything about implementations.
</p>

<p>
I really hope that they at least attempted to unify various <i>in-house
implementations</i> of <i>Streams</i> and <i>Futures</i> and what not. There is no easy or
quick way to <i>evolve stable intermediate forms</i> which is a principal requirement for
an ongoing evolutionary process.
</p>

<p>
The mantra <i>Principle-based is better than rule-based</i> should be the motto
of <code>Scala 3</code>.
</p>

<p>
The sad thing is refusal to just copy fundamental innovations from other
languages
</p>
<ul class="org-ul">
<li><code>where</code> clauses from CLU</li>
<li>modules of Ocaml (it has to be the Java way)</li>
<li>Some Haskell&rsquo;s typing extensions which have proven to be useful.</li>
</ul>

<p>
Anyway, whatever.
</p>
</div>
</div>
<div id="outline-container-orgadb5e3e" class="outline-2">
<h2 id="orgadb5e3e">Modern tools</h2>
<div class="outline-text-2" id="text-orgadb5e3e">
<ul class="org-ul">
<li><code>cs</code> -  <i>artifact manager</i></li>
<li><code>amm</code> - <i>advanced REPL</i></li>
</ul>

<p>
The Compiler, <code>sbt</code> and <code>amm</code>
</p>
<div class="org-src-container">
<pre class="src src-bash">cs setup
</pre>
</div>

<p>
Language-server, linter, formater
</p>
<div class="org-src-container">
<pre class="src src-bash">cs install bloop metals scalafix scalafmt
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">cs update
</pre>
</div>

<p>
Launch the REPL
</p>
<div class="org-src-container">
<pre class="src src-bash">cs launch ammonite --scala 3.2.1
</pre>
</div>
<p>
import straight from <code>Maven</code>
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #81A1C1;">import</span> $ivy.`com.typesafe.akka<span style="color: #81A1C1;">:</span><span style="color: #8FBCBB;">akka</span>-stream_3<span style="color: #81A1C1;">:</span><span style="color: #81A1C1;">2.7.0</span>`
</pre>
</div>
<p>
Basic configuration
<code>build.sbt</code>
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #81A1C1;">val</span> <span style="color: #D8DEE9;">scala3Version</span> <span style="color: #81A1C1;">=</span> <span style="color: #A3BE8C;">"3.2.1"</span>
<span style="color: #81A1C1;">val</span> <span style="color: #D8DEE9;">AkkaVersion</span> <span style="color: #81A1C1;">=</span> <span style="color: #A3BE8C;">"2.7.0"</span>

<span style="color: #81A1C1;">ThisBuild</span> / scalaVersion := scala3Version
<span style="color: #81A1C1;">ThisBuild</span> / scalacOptions ++= <span style="color: #81A1C1;">Seq</span>(<span style="color: #A3BE8C;">"-language:_"</span>, <span style="color: #A3BE8C;">"-deprecation"</span>)

<span style="color: #81A1C1;">lazy</span> <span style="color: #81A1C1;">val</span> <span style="color: #D8DEE9;">root</span> <span style="color: #81A1C1;">=</span> project
  .in(file(<span style="color: #A3BE8C;">"."</span>))
  .settings(

    scalaVersion := scala3Version,

    libraryDependencies += <span style="color: #A3BE8C;">"com.typesafe.akka"</span> %% <span style="color: #A3BE8C;">"akka-stream"</span> % <span style="color: #81A1C1;">AkkaVersion</span>,
  )
</pre>
</div>
<p>
<code>project/plugins.sbt</code>
</p>
<div class="org-src-container">
<pre class="src src-scala">addSbtPlugin(<span style="color: #A3BE8C;">"ch.epfl.scala"</span> % <span style="color: #A3BE8C;">"sbt-bloop"</span> % <span style="color: #A3BE8C;">"1.5.4"</span>)

addSbtPlugin(<span style="color: #A3BE8C;">"ch.epfl.scala"</span> % <span style="color: #A3BE8C;">"sbt-scalafix"</span> % <span style="color: #A3BE8C;">"0.10.4"</span>)
addSbtPlugin(<span style="color: #A3BE8C;">"org.scalameta"</span> % <span style="color: #A3BE8C;">"sbt-scalafmt"</span> % <span style="color: #A3BE8C;">"2.4.6"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org72eddee" class="outline-2">
<h2 id="org72eddee">Editor support</h2>
<div class="outline-text-2" id="text-org72eddee">
<p>
Be aware of which <code>sbt</code> binary is in your <code>$PATH</code>, which version is
specified in <code>project/build.properties</code> and which version has been
installed by <code>cs</code>. Usually there is a version mismatch.
</p>

<p>
Older <code>Vim</code> plugins check by calling <code>scalac</code>, so make sure there is no <i>Scala2</i> <code>scalac</code>
binary in the <code>$PATH</code>. By default Scala3 calls the compiler <code>scala3-compiler</code>.
</p>

<p>
Since <code>cs</code> is the modern tool of choice, make sure your <code>$HOME/.local/share/coursier/bin/</code> is in the <code>$PATH</code>
</p>

<p>
<code>scalafmt</code> needs to specify a <i>dialect</i> in the <code>.scalafmt.conf</code>.
</p>
</div>
<div id="outline-container-orgeba9bc0" class="outline-3">
<h3 id="orgeba9bc0">Metals</h3>
<div class="outline-text-3" id="text-orgeba9bc0">
<p>
The only LSP-server available is <code>metals</code> but it is buggy as fuck. It
relies on <code>bloop</code>, so make sure it is installed by <code>cs</code>.
</p>

<p>
It fails with idiotic errors (cannot start <code>bsp</code>, etc) when you have
<i>proxy</i> variables set in your shell environment.
</p>

<p>
Degenerates cannot ignore <i>proxy settings</i> for <i>localhost</i> connections.
</p>

<p>
They are also trying to install big <code>jars</code> in background, not being aware
that there are millions of people behind crappy ADSL lines in the third
world.
</p>

<p>
The fucking crap failed with <i>timed out exceptions</i>, leaving everything in an
inconsistent state.
</p>
</div>
</div>
</div>
<div id="outline-container-org022bc12" class="outline-2">
<h2 id="org022bc12">Better abstractions</h2>
<div class="outline-text-2" id="text-org022bc12">
<p>
Refinement of <i>implicits</i> (of implicit <i>contexts</i>) by using a common
mathematical jargon.
</p>

<p>
The general principle of a <i>context</i> is that one does not have to always mention
some properties or attributes.
</p>

<p>
Conceptually similar to <i>partial application</i>, so one does not have to
pass it all around.
</p>

<p>
An implicit value can be &ldquo;inferred&rdquo; by the compiler or <i>selected explicitly</i>
among many.
</p>
</div>
<div id="outline-container-org8ba50a5" class="outline-3">
<h3 id="org8ba50a5">Using (clauses)</h3>
<div class="outline-text-3" id="text-org8ba50a5">
<p>
Optional arguments with <i>default values</i> which can be omitted at a <i>call site</i>.
</p>

<p>
Values should be automatically provided by the <i>context</i>.
</p>
</div>
</div>
<div id="outline-container-orge5416d2" class="outline-3">
<h3 id="orge5416d2">Given (instances)</h3>
<div class="outline-text-3" id="text-orge5416d2">
<p>
This corresponds to some &ldquo;standard property&rdquo; that we always assume -
<i>given that&#x2026;</i>. The common synonym is <i>provided that&#x2026;</i>
</p>

<p>
Define <i>terms</i> that can be used <i>by the compiler</i> to fill in the <i>missing
arguments</i>.
</p>
</div>
</div>
</div>

<div id="outline-container-org75fdeda" class="outline-2">
<h2 id="org75fdeda">Libraries</h2>
<div class="outline-text-2" id="text-org75fdeda">
<p>
Most of them are over-&ldquo;engineered&rdquo; and bloated, without any effort of making the
abstractions <i>minimal</i> and &ldquo;just right&rdquo; (optimal). Such &ldquo;natural
selection&rdquo; (of gradual refinement and reduction to a local optimum)
takes decades (like Common Lisp, Ocaml stdlib or Haskell&rsquo;s prelude).
</p>

<p>
Most of corporate code are of <i>low-effort</i>, and mostly &ldquo;copying&rdquo; of <i>imperative</i> implementations from one another.
</p>
<ul class="org-ul">
<li><code>zio2</code> - functional style I/O</li>
<li><code>cats</code> - some standard <i>type-classes</i> for common <i>algebraic structures</i>.</li>
<li><code>akka</code> - the supposedly done right <i>basic building</i> blocks. Use it.</li>
<li>The <code>Twitter stack</code> (still Scala 2)</li>
<li><code>Kafka</code> - steams</li>
<li><code>Spark</code> - the <i>killer-app</i> (still Scala 2)</li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: &lt;schiptsov@gmail.com&gt;</p>
<p class="email">Email: <a href="mailto:lngnmn2@yahoo.com">lngnmn2@yahoo.com</a></p>
<p class="date">Created: 2022-11-30 Wed 10:44</p>
</div>
</body>
</html>